

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>LOFT-Q Quick Guide for mainline kernel &mdash; Mixtile Project documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Mixtile Project documentation" href="../../index.html"/>
        <link rel="up" title="English Documents" href="../../en_root.html"/>
        <link rel="next" title="LOFT-Q Owncloud Guide" href="en-owncloud-howto.html"/>
        <link rel="prev" title="LOFT-Q Quick Guide for Lebacy Kernel" href="en-legacy-quick-guide.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../index.html" class="icon icon-home"> mixtile
        

        
          
          <img src="../../_static/mixtile-logo.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../zh_root.html">中文文档</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../zh_root.html#loft-q">LOFT-Q 相关文档</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-android-cust.html">LOFT-Q Android 定制化指南</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-android-network-debug.html">Android adb 网络调试</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-android-network-debug.html#id1">前期准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-android-network-debug.html#gnu-linux">GNU/Linux 系统准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-android-network-debug.html#windows">Windows 系统准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-android-network-debug.html#adb">连接网络 ADB</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-android-network-debug.html#eclipse">Eclipse 调试</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-android-network-debug.html#id3">注意事项</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-gpio-guide.html">LOFT-Q GPIO 使用</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-gpio-guide.html#id2">介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-gpio-guide.html#gpio">GPIO 引脚说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-gpio-guide.html#id3">GPIO 内核配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-gpio-guide.html#id4">GPIO 使用示例</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-gpio-guide.html#id6">更多参考</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-intro.html">LOFT-Q 简介</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-intro.html#id1">开放硬件</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-intro.html#id2">软件介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-intro.html#id3">硬件介绍</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-jn5168-guide.html">LOFT-Q JN5168 使用说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-legacy-driver-guide.html">LOFT-Q 旧版内核驱动指南</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-legacy-driver-guide.html#id1">驱动介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-legacy-driver-guide.html#id3">内核驱动结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-legacy-quick-guide.html">LOFT-Q 旧版系统快速指南</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-legacy-quick-guide.html#id1">旧版环境准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-legacy-quick-guide.html#uboot">旧版 UBoot 构建</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-legacy-quick-guide.html#linux">旧版 Linux 内核构建</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-legacy-quick-guide.html#buildroot">Buildroot 构建</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-legacy-quick-guide.html#android">Android 构建使用</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-mainline-quick-guide.html">LOFT-Q 主流系统快速指南</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-mainline-quick-guide.html#uboot">主流 Uboot 构建</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-mainline-quick-guide.html#linux">主流 Linux 构建</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-mainline-quick-guide.html#debian">Debian 构建</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-mainline-quick-guide.html#ubuntu">Ubuntu 构建</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-mainline-quick-guide.html#opensuse">OpenSUSE 使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-mainline-quick-guide.html#id8">更多说明</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-owncloud-howto.html">LOFT-Q Owncloud 说明</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-owncloud-howto.html#debian">Debian 配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-owncloud-howto.html#opensuse">openSUSE 配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-owncloud-howto.html#id1">更多参考</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-product-intro.html">LOFT-Q 产品说明</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-product-intro.html#id1">产品概述</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-product-intro.html#id2">产品特性</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-product-intro.html#id3">产品配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-product-intro.html#id5">硬件详细参数</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-product-intro.html#id15">软件资源</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../zh/loftq/zh-seafile-howto.html">LOFT-Q Seafile 说明</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-seafile-howto.html#debian-chroot">配置 Debian chroot 环境</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../zh/loftq/zh-seafile-howto.html#seafile">编译 Seafile 服务软件</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../zh_root.html#gena">GENA 相关文档</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../en_root.html">English Documents</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../en_root.html#loft-q">LOFT-Q</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="en-android-cust.html">LOFT-Q Android Customization guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="en-intro.html">LOFT-Q Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="en-intro.html#open-hardware">Open Hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-intro.html#software">Software</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-intro.html#hardware">Hardware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="en-legacy-quick-guide.html">LOFT-Q Quick Guide for Lebacy Kernel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="en-legacy-quick-guide.html#lebacy-build-environment">Lebacy Build Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-legacy-quick-guide.html#legacy-uboot-building">Legacy Uboot Building</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-legacy-quick-guide.html#legacy-linux-kernel-building">Legacy Linux Kernel Building</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-legacy-quick-guide.html#buildroot-building">Buildroot building</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-legacy-quick-guide.html#android-building">Android building</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="">LOFT-Q Quick Guide for mainline kernel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mainline-u-boot-building">Mainline u-boot building</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mainline-kernel-building">Mainline kernel building</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debian-building">Debian building</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ubuntu-building">Ubuntu building</a></li>
<li class="toctree-l4"><a class="reference internal" href="#opensuse">OpenSUSE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="en-owncloud-howto.html">LOFT-Q Owncloud Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="en-owncloud-howto.html#owncloud-for-debian">Owncloud for Debian</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-owncloud-howto.html#owncloud-for-opensuse">Owncloud for openSUSE</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-owncloud-howto.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="en-seafile-howto.html">LOFT-Q Seafile Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="en-seafile-howto.html#debian-chroot-setup">Debian chroot setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="en-seafile-howto.html#seafile-service-building">Seafile Service building</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../en_root.html#gena">GENA</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">mixtile</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../en_root.html">English Documents</a> &raquo;</li>
      
    <li>LOFT-Q Quick Guide for mainline kernel</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/en/loftq/en-mainline-quick-guide.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="loft-q-quick-guide-for-mainline-kernel">
<h1>LOFT-Q Quick Guide for mainline kernel<a class="headerlink" href="#loft-q-quick-guide-for-mainline-kernel" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Organization:</th><td class="field-body">Mixtile Team</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Phil.Han &lt;<a class="reference external" href="mailto:phil&#46;han&#37;&#52;&#48;focalcrest&#46;com">phil<span>&#46;</span>han<span>&#64;</span>focalcrest<span>&#46;</span>com</a>&gt;</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">0.1</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">2015.01.23</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/loftq-board.png"><img alt="../../_images/loftq-board.png" class="align-center" src="../../_images/loftq-board.png" style="width: 50%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>LOFT-Q is the second prototyping board of Mixtile project. Based on AllWinner A31 SOC, designed for embedded developers, engineers, makers and hackers, it can be used as home media center, personal could device, NAS, etc. This guide will help developers quickly building the environment, compiling usable os and customizing you own application.</p>
<div class="section" id="mainline-u-boot-building">
<h2>Mainline u-boot building<a class="headerlink" href="#mainline-u-boot-building" title="Permalink to this headline">¶</a></h2>
<p>Now sunxi u-boot is heavily developed with the effort of sunxi community, and the support for A31 series is almostly completed.</p>
<div class="section" id="get-mainline-u-boot">
<h3>Get mainline u-boot<a class="headerlink" href="#get-mainline-u-boot" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre>git clone https://github.com/mixtile/loftq-uboot-next.git
</pre></div>
</div>
</div>
<div class="section" id="build-mainline-u-boot">
<h3>Build mainline u-boot<a class="headerlink" href="#build-mainline-u-boot" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">cd </span>loftq-uboot-next

make <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi- mixtile_loftq_defconfig

make <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-
</pre></div>
</div>
<p>when making finished, it will create <strong>u-boot-sunxi-with-spl.bin</strong>, and this is the file we need.</p>
</div>
</div>
<div class="section" id="mainline-kernel-building">
<h2>Mainline kernel building<a class="headerlink" href="#mainline-kernel-building" title="Permalink to this headline">¶</a></h2>
<p>Now, the mainline linux kernel has partly supported A31 soc with the help of sunxi community and volunteers all around the world. If we are using the GNU/Linux system, we can use the mainline kernel with latest features.</p>
<div class="section" id="get-mainline-kernel">
<h3>Get Mainline kernel<a class="headerlink" href="#get-mainline-kernel" title="Permalink to this headline">¶</a></h3>
<p>LOFT-Q now has forked the mainline upstream kernel and add some customizations upon it. you can fork it from the github of Mixtile project.</p>
<div class="highlight-sh"><div class="highlight"><pre>git clone https://github.com/mixtile/linux.git -b loftq-dev
</pre></div>
</div>
<p><strong>Note：</strong> the <cite>master</cite> branch is the referring upstream branch, and <cite>loftq-dev</cite> is the customized branch.</p>
</div>
<div class="section" id="build-mainline-kernel">
<h3>Build Mainline kernel<a class="headerlink" href="#build-mainline-kernel" title="Permalink to this headline">¶</a></h3>
<p>After getting the code, we should follow commands below to build it.</p>
<div class="highlight-sh"><div class="highlight"><pre>cp arch/arm/configs/mixtile_loftq_defconfig .config

make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-

make <span class="nv">INSTALL_MOD_PATH</span><span class="o">=</span>output <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi- modules_install
</pre></div>
</div>
<p>when building is finished, we can get the directories and files we needed:</p>
<ul class="simple">
<li><cite>arch/arm/boot/zImage</cite>，mainline kernel image.</li>
<li><cite>arch/arm/boot/dts/sun6i-a31-mixtile-loftq.dtb</cite>，the dts file for mainline kernel.</li>
<li><cite>output/lib/modules</cite>，the modules for mainline kernel.</li>
</ul>
<p>As for the image, dts and modules, we should copy them to referring paths of GNU/Linux rootfs to make it bootable, also we can move them to other customized paths.</p>
</div>
</div>
<div class="section" id="debian-building">
<h2>Debian building<a class="headerlink" href="#debian-building" title="Permalink to this headline">¶</a></h2>
<p>Debian is the base system for Many GNU/Linux systems, Now it could also run on LOFT-Q with some simple configurations.</p>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>Before building Debian, we will have to prepare some files needed according to different kernel released.</p>
<p>kernel config binary for Allwinner customized kernel:</p>
<ul class="simple">
<li>script.bin: the configuration file for Allwinner soc, used for setting up kernel and uboot, generated from sys_config.fex.</li>
</ul>
<p>dts config for Mainline kernel:</p>
<ul class="simple">
<li>sun6i-a31-mixtile-loftq.dtb: the dts needed by mainline kernel, when building kernel, it will be generated automatically.</li>
</ul>
<p>other files for both kinds of kernel:</p>
<ul class="simple">
<li>boot.scr: could be loaded and executed by Uboot, contains configurations and commands for booting up Linux kernel, generated from boot.cmd.</li>
<li>u-boot-sunxi-with-spl.bin: the Uboot binary file, built by mainline uboot provided by linux-sunxi community, This release is based on <strong>next</strong> branch of <a class="reference external" href="http://git.denx.de/?p=u-boot/u-boot-sunxi.git;a=summary">u-boot-sunxi</a>.</li>
<li>uImage and referring kernel modules: linux kernel and kernel modules of LOFT-Q.</li>
<li>rootfs archive of debian: rootfs archive for ARM platform, which contains the base system and configs of GNU/Linux.</li>
</ul>
</div>
<div class="section" id="get-debian-rootfs">
<h3>Get Debian rootfs<a class="headerlink" href="#get-debian-rootfs" title="Permalink to this headline">¶</a></h3>
<p>We can follow below commands to get rootfs of Debian, more info, please refer to  <a class="reference external" href="https://wiki.debian.org/ArmHardFloatChroot">https://wiki.debian.org/ArmHardFloatChroot</a> .</p>
<ul>
<li><p class="first">get the latest unstable armhf base system with <strong>qemu-deootstrap</strong> .</p>
<div class="highlight-sh"><div class="highlight"><pre>qemu-debootstrap --no-check-gpg --arch<span class="o">=</span>armhf sid /chroots/sid-armhf ftp://ftp.debian.org/debian/
</pre></div>
</div>
<p>it will take a long time to getting the rootfs depending on your network environment.</p>
</li>
<li><p class="first">add source repository of Debian, please add following lines to <strong>/chroots/sid-armhf/etc/apt/sources.list</strong>:</p>
<div class="highlight-sh"><div class="highlight"><pre>deb http://ftp.debian.org/debian sid main
deb-src http://ftp.debian.org/debian sid main
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="generate-script-bin">
<h3>Generate script.bin<a class="headerlink" href="#generate-script-bin" title="Permalink to this headline">¶</a></h3>
<p>script.bin is the configuration file for Uboot and Linux kernel of Allwinner soc, and we could get or make it:</p>
<ul>
<li><p class="first">prebuilt script.bin: <a class="reference external" href="https://github.com/mixtile/loftq-build/tree/master/bsp/binary/boot">https://github.com/mixtile/loftq-build/tree/master/bsp/binary/boot</a> .</p>
</li>
<li><p class="first">make script.bin:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">cd </span>loftq-build/bsp/configs

./bin/fexc sys_config.fex script.bin
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="generate-boot-scr">
<h3>Generate boot.scr<a class="headerlink" href="#generate-boot-scr" title="Permalink to this headline">¶</a></h3>
<p>boot.scr is the binary file which could be loaded and executed by UBoot for preparing booting environment and loading Linux kernel. we also can get or make following steps as below:</p>
<ul>
<li><p class="first">prebuilt mainline boot.scr: <a class="reference external" href="https://github.com/mixtile/loftq-build/tree/master/bsp/binary/boot">https://github.com/mixtile/loftq-build/tree/master/bsp/binary/boot</a> .</p>
</li>
<li><p class="first">make boot.scr:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">cd </span>loftq-build/bsp/configs

mkimage -C none -A arm -T script -d boot_single.cmd boot.scr
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>boot.scr for legacy kernel: <strong>loftq-build/bsp-legacy/configs/configs/boot_single.cmd</strong></li>
<li>boot.scr for mainline kernel: <strong>loftq-build/bsp/configs/boot_single.cmd</strong></li>
</ul>
</div>
</li>
</ul>
<div class="section" id="boot-cmd-rules-guide">
<h4>boot.cmd rules guide<a class="headerlink" href="#boot-cmd-rules-guide" title="Permalink to this headline">¶</a></h4>
<p>boot.cmd used for generating boot.scr, the loadable and executable uboot script. The contants of boot_single.cmd for the mainline uboot script as below:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">bootdelay</span><span class="o">=</span>3
<span class="nv">console</span><span class="o">=</span>ttyS0,115200
<span class="nv">mmc_root</span><span class="o">=</span>/dev/mmcblk0p1
<span class="nv">init</span><span class="o">=</span>/sbin/init
<span class="nv">loglevel</span><span class="o">=</span>8

setenv bootargs noinitrd <span class="nv">console</span><span class="o">=</span><span class="si">${</span><span class="nv">console</span><span class="si">}</span> <span class="nv">console</span><span class="o">=</span>tty0 <span class="nv">init</span><span class="o">=</span><span class="si">${</span><span class="nv">init</span><span class="si">}</span> <span class="nv">loglevel</span><span class="o">=</span><span class="si">${</span><span class="nv">loglevel</span><span class="si">}</span> <span class="nv">vmalloc</span><span class="o">=</span><span class="si">${</span><span class="nv">vmalloc</span><span class="si">}</span> <span class="nv">partitions</span><span class="o">=</span><span class="si">${</span><span class="nv">partitions</span><span class="si">}</span> <span class="nv">root</span><span class="o">=</span><span class="si">${</span><span class="nv">mmc_root</span><span class="si">}</span> rootwait rw <span class="nv">rootfstype</span><span class="o">=</span>ext4 <span class="nv">panic</span><span class="o">=</span><span class="m">10</span> <span class="nv">consoleblank</span><span class="o">=</span><span class="m">0</span> <span class="si">${</span><span class="nv">extra</span><span class="si">}</span>

ext4load mmc <span class="m">0</span> 0x46000000 boot/mainline/zImage
ext4load mmc <span class="m">0</span> 0x48000000 boot/mainline/sun6i-a31-mixtile-loftq.dtb
bootz 0x46000000 - 0x48000000
</pre></div>
</div>
<p>Statements parsing：</p>
<ul class="simple">
<li><strong>bootdelay=3</strong>, specify the delaying time before uboot loading kernel, user could choose different operations, just like the choices of BIOS for PC.</li>
<li><strong>console=ttyS0,115200</strong>, the params for console device and baudrate, here we set console device to <strong>ttyS0</strong>, and baudrate as <strong>115200</strong>.</li>
<li><strong>mmc_root</strong>，the volumes that root file system is located.</li>
<li><strong>init=/sbin/init</strong>, the initial execute file/script after booting up.</li>
<li><strong>loglevel=8</strong>, the level for system logging.</li>
<li><strong>setenv bootargs ...</strong>, setup the parameters we specified as uboot environment params.</li>
<li><strong>ext4load mmc 0 0x46000000 boot/mainline/zImage</strong>, load specified kernel to memory, here we put mainline referring files to <strong>/boot/mainline/</strong> directory, and user could give some other paths, which is usually under <cite>/boot</cite> directory.</li>
<li><strong>ext4load mmc 0 0x48000000 boot/mainline/sun6i-a31-mixtile-loftq.dtb</strong>, load dts to memory, dts is needed by mainline kernel.</li>
<li><strong>bootz 0x46000000 - 0x48000000</strong>, run kernel and dts from the memory offset we specified previous steps.</li>
</ul>
<p>As for legacy kernel, we will have different commands:</p>
<div class="highlight-sh"><div class="highlight"><pre>ext4load mmc <span class="m">0</span> 0x43000000 boot/script.bin
ext4load mmc <span class="m">0</span> 0x48000000 boot/uImage
bootm 0x48000000
</pre></div>
</div>
<p>Statements：</p>
<ul class="simple">
<li><strong>ext4load mmc 0 0x43000000 boot/script.bin</strong>，the Allwinner customized kernel config file.</li>
<li><strong>ext4load mmc 0 0x48000000 boot/uImage</strong>，this is the binary format for u-boot, not zImage used by mainline kernel, more info about the difference, please refer to <a class="reference external" href="http://stackoverflow.com/questions/22322304/image-vs-zimage-vs-uimage">http://stackoverflow.com/questions/22322304/image-vs-zimage-vs-uimage</a>.</li>
<li><strong>bootm 0x48000000</strong>，load legacy kernel from memory offset we specified above.</li>
</ul>
</div>
</div>
<div class="section" id="build-u-boot-sunxi-with-spl-bin">
<h3>Build u-boot-sunxi-with-spl.bin<a class="headerlink" href="#build-u-boot-sunxi-with-spl-bin" title="Permalink to this headline">¶</a></h3>
<p>Please refer to previous <a class="reference internal" href="#mainline-u-boot-building">Mainline u-boot building</a> for generating  <strong>u-boot-sunxi-with-spl.bin</strong>.</p>
</div>
<div class="section" id="build-linux-kernel-and-its-modules">
<h3>Build Linux kernel and its modules<a class="headerlink" href="#build-linux-kernel-and-its-modules" title="Permalink to this headline">¶</a></h3>
<p>we have introduced the kernel building process, please refer to <a class="reference internal" href="#mainline-kernel-building">Mainline kernel building</a> .</p>
</div>
<div class="section" id="partition-sd-card">
<h3>Partition SD card<a class="headerlink" href="#partition-sd-card" title="Permalink to this headline">¶</a></h3>
<p>The layout of bootable SD card for LOFT-Q as below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="28%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">start</th>
<th class="head">size</th>
<th class="head">usage</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>8KB</td>
<td>unused, for partition table etc.</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>24KB</td>
<td>Initial SPL loader</td>
</tr>
<tr class="row-even"><td>32</td>
<td>512KB</td>
<td>U-Boot</td>
</tr>
<tr class="row-odd"><td>544</td>
<td>128KB</td>
<td>environment</td>
</tr>
<tr class="row-even"><td>672</td>
<td>352KB</td>
<td>reserved</td>
</tr>
<tr class="row-odd"><td>1024</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>free for partitions</td>
</tr>
</tbody>
</table>
<p>As for partitions of SD/Emmc, we have to make it in host os (Linux), we take &#8216;/dev/mmcblk0&#8217; as example.</p>
<ol class="arabic">
<li><p class="first">clear partitions of SD/Emmc, please backup your data before clearing.</p>
<div class="highlight-sh"><div class="highlight"><pre>sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/dev/mmcblk0 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span>1
</pre></div>
</div>
</li>
<li><p class="first">start partitioning.</p>
<div class="highlight-sh"><div class="highlight"><pre>sudo fdisk /dev/mmcblk0
</pre></div>
</div>
</li>
<li><p class="first">process partitioning.</p>
<div class="highlight-sh"><div class="highlight"><pre>Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: n                                 <span class="c"># Type n</span>
Partition <span class="nb">type</span>:
   p   primary <span class="o">(</span><span class="m">0</span> primary, <span class="m">0</span> extended, <span class="m">4</span> free<span class="o">)</span>
   e   extended
Select <span class="o">(</span>default p<span class="o">)</span>:                                     <span class="c"># Press Enter Key</span>
Using default response p
Partition number <span class="o">(</span>1-4, default 1<span class="o">)</span>:                      <span class="c"># Press Enter Key</span>
Using default value 1
First sector <span class="o">(</span>2048-15523839, default 2048<span class="o">)</span>:             <span class="c"># Press Enter Key</span>
Using default value 2048
Last sector, +sectors or +size<span class="o">{</span>K,M,G<span class="o">}</span> <span class="o">(</span>2048-15523839, default 15523839<span class="o">)</span>:      <span class="c"># Press Enter Key</span>

Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: w                                   <span class="c"># Enter w and press Enter</span>

The partition table has been altered!
</pre></div>
</div>
</li>
<li><p class="first">format partition as Ext4.</p>
<div class="highlight-sh"><div class="highlight"><pre>sudo mkfs.ext4 /dev/mmcblk0p1
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="burn-uboot-to-sd-emmc">
<h3>Burn Uboot to SD/Emmc<a class="headerlink" href="#burn-uboot-to-sd-emmc" title="Permalink to this headline">¶</a></h3>
<p>After partitions prepared, we can burn <strong>u-boot-sunxi-with-spl.bin</strong> to SD card.</p>
<div class="highlight-sh"><div class="highlight"><pre>sudo dd <span class="k">if</span><span class="o">=</span>u-boot-sunxi-with-spl.bin <span class="nv">of</span><span class="o">=</span>/dev/mmcblk0 <span class="nv">bs</span><span class="o">=</span><span class="m">1024</span> <span class="nv">seek</span><span class="o">=</span>8
</pre></div>
</div>
</div>
<div class="section" id="prepare-rootfs-for-sd-card">
<h3>Prepare rootfs for SD card<a class="headerlink" href="#prepare-rootfs-for-sd-card" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre>sudo mount -t ext4 /dev/mmcblk0p1 /mnt

sudo cp -r /chroot/sid-armhf/* /mnt
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>/chroot/sid-armhf</strong> is the rootfs path we prepared in <a class="reference internal" href="#get-debian-rootfs">Get Debian rootfs</a> .</p>
</div>
</div>
<div class="section" id="copy-bsp-files-to-ext4-partition">
<h3>Copy BSP files to ext4 partition<a class="headerlink" href="#copy-bsp-files-to-ext4-partition" title="Permalink to this headline">¶</a></h3>
<div class="section" id="copy-mainline-bsp-files">
<h4>Copy Mainline BSP files<a class="headerlink" href="#copy-mainline-bsp-files" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>boot.scr</strong> to <strong>/mnt/boot/</strong> 。</li>
<li><strong>linux/arch/arm/boot/zImage</strong> to <strong>/mnt/boot/mainline/</strong> 。</li>
<li><strong>linux/arch/arm/boot/dts/sun6i-a31-mixtile-loftq.dtb</strong> to <strong>/mnt/boot/mainline/</strong> 。</li>
<li><strong>linux/output/lib/modules</strong> to <strong>/mnt/lib</strong> 。</li>
</ul>
<p>Sample commands:</p>
<div class="highlight-sh"><div class="highlight"><pre>sudo cp boot.scr /mnt/boot
sudo cp linux/arch/arm/boot/zImage /mnt/boot/mainline
sudo cp linux/arch/arm/boot/dts/sun6i-a31-mixtile-loftq.dtb /mnt/boot/mainline
sudo cp -r linux/output/lib/modules /mnt/lib
sudo sync
sudo umount /mnt
</pre></div>
</div>
<p>After we finished all the steps above, now we can enter the Debian world, just pluging sd card to LOFT-Q and power it on.</p>
</div>
</div>
</div>
<div class="section" id="ubuntu-building">
<h2>Ubuntu building<a class="headerlink" href="#ubuntu-building" title="Permalink to this headline">¶</a></h2>
<p>ubuntu support is still under working, please wait ...</p>
</div>
<div class="section" id="opensuse">
<h2>OpenSUSE<a class="headerlink" href="#opensuse" title="Permalink to this headline">¶</a></h2>
<p>openSUSE is one of the best GNU/Linux distribution in the world, which is from German. Now we can boot up and try openSUSE JeOS for ARM with customized Uboot and Linux kernel.</p>
<div class="section" id="jeos-rootfs">
<h3>JeOS rootfs<a class="headerlink" href="#jeos-rootfs" title="Permalink to this headline">¶</a></h3>
<p>There are several versions of JeOS that can work on LOFT-Q.</p>
<ul class="simple">
<li>Factory: <a class="reference external" href="http://download.opensuse.org/ports/armv7hl/factory/images/">http://download.opensuse.org/ports/armv7hl/factory/images/</a></li>
<li>13.1: <a class="reference external" href="http://download.opensuse.org/ports/armv7hl/distribution/13.1/appliances/">http://download.opensuse.org/ports/armv7hl/distribution/13.1/appliances/</a></li>
<li>12.3: <a class="reference external" href="http://download.opensuse.org/ports/armv7hl/distribution/12.3/images/">http://download.opensuse.org/ports/armv7hl/distribution/12.3/images/</a></li>
</ul>
<p>We can choose one version for testing. More info about different versions, please refer to <a class="reference external" href="https://en.opensuse.org/HCL:Chroot">https://en.opensuse.org/HCL:Chroot</a> .</p>
<p>Here we take 13.1 version as testing example. then we have to download the <strong>openSUSE-*-ARM-JeOS.armv7-rootfs-*.tbz</strong> tarball. As for the bootable SD card makeing process, it&#8217;s almose the same with <a class="reference internal" href="#debian-building">Debian building</a>, and the only difference is <strong>rootfs</strong> creating and copying.</p>
<p>Now we creating rootfs with <strong>openSUSE-Factory-ARM-JeOS.armv7-rootfs.armv7l-Current.tbz</strong>, orders as below:</p>
<div class="highlight-sh"><div class="highlight"><pre>sudo tar -C /mnt -xjf openSUSE-Factory-ARM-JeOS.armv7-rootfs.armv7l-Current.tbz
</pre></div>
</div>
<p>Now, we follow <a class="reference internal" href="#copy-bsp-files-to-ext4-partition">Copy BSP files to ext4 partition</a> to add BSP and kernel modules, then we just plug in SD card to LOFT-Q and power it on, Here is the openSUSE world.</p>
</div>
</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<div class="section" id="gnu-linux-archives">
<h3>GNU/Linux Archives<a class="headerlink" href="#gnu-linux-archives" title="Permalink to this headline">¶</a></h3>
<p>We have precompiled tarballs of openSUSE and Debian linux system for booting up linux quickly.</p>
<ul class="simple">
<li>Debian sid release</li>
<li>openSUSE 13.1 release</li>
<li>openSUSE Factory release</li>
</ul>
<p>Link: <a class="reference external" href="http://www.mixtile.com/downloads/loft-q/">http://www.mixtile.com/downloads/loft-q/</a></p>
<p>All you have to do is <a class="reference internal" href="#partition-sd-card">Partition SD card</a> and <a class="reference internal" href="#burn-uboot-to-sd-emmc">Burn Uboot to SD/Emmc</a> as described above, and decompress the tarball to the Ext4 partion, then the Linux world is open.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="en-owncloud-howto.html" class="btn btn-neutral float-right" title="LOFT-Q Owncloud Guide" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="en-legacy-quick-guide.html" class="btn btn-neutral" title="LOFT-Q Quick Guide for Lebacy Kernel" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Mixtile Project.
      Last updated on Sep 18, 2015.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>